<%+header%>
<h2><%:Node Manager - Providers%></h2>

<form id="provForm" method="post" action="<%=luci.dispatcher.build_url('admin/services/nodemanager/providers')%>">
  <table class="table">
    <thead>
      <tr><th><%:Provider Name%></th><th><%:Subscribe URL%></th><th></th></tr>
    </thead>
    <tbody id="provBody">
      <% for _,p in ipairs(providers or {}) do %>
      <tr>
        <td><input class="cbi-input-text" name="pname[]" value="<%=p.name%>" required/></td>
        <td><input class="cbi-input-text" name="purl[]"  value="<%=p.url%>"  required/></td>
        <td><button type="button" class="cbi-button cbi-button-remove" onclick="rmRow(this)">✕</button></td>
      </tr>
      <% end %>
    </tbody>
  </table>
  <div>
    <button type="button" class="cbi-button cbi-button-add" onclick="addRow()">+</button>
    <button type="submit" class="cbi-button cbi-button-apply"><%:Save%></button>
  </div>
</form>

<script>
function addRow(){ const tr=document.createElement('tr'); tr.innerHTML=
  '<td><input class="cbi-input-text" name="pname[]" required/></td>'+
  '<td><input class="cbi-input-text" name="purl[]" required placeholder="http(s)://..."/></td>'+
  '<td><button type="button" class="cbi-button cbi-button-remove" onclick="rmRow(this)">✕</button></td>';
  document.getElementById('provBody').appendChild(tr);
}
function rmRow(btn){ btn.closest('tr').remove(); }
document.getElementById('provForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const r=await fetch(e.target.action,{method:'POST',body:new FormData(e.target)}); const j=await r.json();
  if(j.code===0) location.reload(); else alert(j.msg||'Error');
});
</script>
<%+footer%>
